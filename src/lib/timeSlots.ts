/**\n * Time slot utilities for DSA Grinders cron jobs\n * Handles 30-minute time slot calculations and user scheduling\n */\n\nexport interface TimeSlot {\n  hour: number;\n  slotStart: number; // 0 or 30\n  slotEnd: number;   // 30 or 60\n  label: string;     // \"09:00-09:30\" or \"09:30-10:00\"\n}\n\n/**\n * Get the current 30-minute time slot\n */\nexport function getCurrentTimeSlot(): TimeSlot {\n  const now = new Date();\n  const hour = now.getHours();\n  const minute = now.getMinutes();\n  \n  const slotStart = minute < 30 ? 0 : 30;\n  const slotEnd = slotStart + 30;\n  \n  const startLabel = `${hour.toString().padStart(2, '0')}:${slotStart.toString().padStart(2, '0')}`;\n  const endLabel = slotEnd === 60 \n    ? `${(hour + 1).toString().padStart(2, '0')}:00`\n    : `${hour.toString().padStart(2, '0')}:${slotEnd.toString().padStart(2, '0')}`;\n  \n  return {\n    hour,\n    slotStart,\n    slotEnd,\n    label: `${startLabel}-${endLabel}`\n  };\n}\n\n/**\n * Check if a user's dailyGrindTime falls in the specified time slot\n */\nexport function isTimeInSlot(userTime: string | null, slot: TimeSlot): boolean {\n  if (!userTime || !userTime.match(/^\\d{2}:\\d{2}$/)) return false;\n  \n  const [userHour, userMin] = userTime.split(':').map(Number);\n  \n  return userHour === slot.hour && userMin >= slot.slotStart && userMin < slot.slotEnd;\n}\n\n/**\n * Check if a user's dailyGrindTime falls in the current 30-minute slot\n */\nexport function isInCurrentTimeSlot(userTime: string | null): boolean {\n  const currentSlot = getCurrentTimeSlot();\n  return isTimeInSlot(userTime, currentSlot);\n}\n\n/**\n * Get all 48 possible time slots in a day (30-minute intervals)\n */\nexport function getAllTimeSlots(): TimeSlot[] {\n  const slots: TimeSlot[] = [];\n  \n  for (let hour = 0; hour < 24; hour++) {\n    // First half: XX:00-XX:30\n    slots.push({\n      hour,\n      slotStart: 0,\n      slotEnd: 30,\n      label: `${hour.toString().padStart(2, '0')}:00-${hour.toString().padStart(2, '0')}:30`\n    });\n    \n    // Second half: XX:30-XX+1:00\n    const endHour = hour === 23 ? 0 : hour + 1;\n    slots.push({\n      hour,\n      slotStart: 30,\n      slotEnd: 60,\n      label: `${hour.toString().padStart(2, '0')}:30-${endHour.toString().padStart(2, '0')}:00`\n    });\n  }\n  \n  return slots;\n}\n\n/**\n * Get time slots that are \"coming up\" in the next 2 hours\n * Useful for testing and preview purposes\n */\nexport function getUpcomingSlots(count: number = 4): TimeSlot[] {\n  const allSlots = getAllTimeSlots();\n  const currentSlot = getCurrentTimeSlot();\n  \n  // Find current slot index\n  const currentIndex = allSlots.findIndex(slot => \n    slot.hour === currentSlot.hour && slot.slotStart === currentSlot.slotStart\n  );\n  \n  if (currentIndex === -1) return allSlots.slice(0, count);\n  \n  // Get next slots (wrap around if necessary)\n  const upcomingSlots: TimeSlot[] = [];\n  for (let i = 1; i <= count; i++) {\n    const index = (currentIndex + i) % allSlots.length;\n    upcomingSlots.push(allSlots[index]);\n  }\n  \n  return upcomingSlots;\n}\n\n/**\n * Parse a time string (HH:MM) and return hour and minute\n */\nexport function parseTime(timeString: string): { hour: number; minute: number } | null {\n  if (!timeString || !timeString.match(/^\\d{2}:\\d{2}$/)) {\n    return null;\n  }\n  \n  const [hour, minute] = timeString.split(':').map(Number);\n  \n  if (hour < 0 || hour > 23 || minute < 0 || minute > 59) {\n    return null;\n  }\n  \n  return { hour, minute };\n}\n\n/**\n * Format a time slot for display\n */\nexport function formatTimeSlot(slot: TimeSlot): string {\n  return `${slot.label} (${getSlotDescription(slot)})`;\n}\n\n/**\n * Get a human-readable description of a time slot\n */\nfunction getSlotDescription(slot: TimeSlot): string {\n  const hour = slot.hour;\n  const isFirstHalf = slot.slotStart === 0;\n  \n  if (hour >= 6 && hour < 12) {\n    return isFirstHalf ? 'Morning' : 'Late Morning';\n  } else if (hour >= 12 && hour < 17) {\n    return isFirstHalf ? 'Afternoon' : 'Late Afternoon';\n  } else if (hour >= 17 && hour < 21) {\n    return isFirstHalf ? 'Evening' : 'Late Evening';\n  } else {\n    return isFirstHalf ? 'Night' : 'Late Night';\n  }\n}\n\n/**\n * Debug helper: get info about current time and slot\n */\nexport function getTimeSlotDebugInfo() {\n  const now = new Date();\n  const currentSlot = getCurrentTimeSlot();\n  const upcomingSlots = getUpcomingSlots(3);\n  \n  return {\n    currentTime: now.toISOString(),\n    localTime: `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`,\n    currentSlot: formatTimeSlot(currentSlot),\n    upcomingSlots: upcomingSlots.map(formatTimeSlot),\n    totalSlotsPerDay: 48\n  };\n}